var SAAS_AUTH="https://saas-pre.haimawan.com/s/rest/api",envType="";
"use strict";function HM_Events(){}function EE(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function addListener(e,t,n,r,i){var s=new EE(n,r||e,i),o=prefix?prefix+t:t;return e._events[o]?e._events[o].fn?e._events[o]=[e._events[o],s]:e._events[o].push(s):(e._events[o]=s,e._eventsCount++),e}function clearEvent(e,t){0===--e._eventsCount?e._events=new HM_Events:delete e._events[t]}function HM_EventEmitter(){this._events=new HM_Events,this._eventsCount=0}var has=Object.prototype.hasOwnProperty,prefix="~";Object.create&&(HM_Events.prototype=Object.create(null),(new HM_Events).__proto__||(prefix=!1)),HM_EventEmitter.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)has.call(e,t)&&n.push(prefix?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},HM_EventEmitter.prototype.listeners=function(e,t){var n=prefix?prefix+e:e,r=this._events[n];if(t)return!!r;if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,o=new Array(s);i<s;i++)o[i]=r[i].fn;return o},HM_EventEmitter.prototype.emit=function(e,t,n,r,i,s){var o=prefix?prefix+e:e;if(!this._events[o])return!1;var c,v,f=this._events[o],a=arguments.length;if(f.fn){switch(f.once&&this.removeListener(e,f.fn,void 0,!0),a){case 1:return f.fn.call(f.context),!0;case 2:return f.fn.call(f.context,t),!0;case 3:return f.fn.call(f.context,t,n),!0;case 4:return f.fn.call(f.context,t,n,r),!0;case 5:return f.fn.call(f.context,t,n,r,i),!0;case 6:return f.fn.call(f.context,t,n,r,i,s),!0}for(v=1,c=new Array(a-1);v<a;v++)c[v-1]=arguments[v];f.fn.apply(f.context,c)}else{var p,_=f.length;for(v=0;v<_;v++)switch(f[v].once&&this.removeListener(e,f[v].fn,void 0,!0),a){case 1:f[v].fn.call(f[v].context);break;case 2:f[v].fn.call(f[v].context,t);break;case 3:f[v].fn.call(f[v].context,t,n);break;case 4:f[v].fn.call(f[v].context,t,n,r);break;default:if(!c)for(p=1,c=new Array(a-1);p<a;p++)c[p-1]=arguments[p];f[v].fn.apply(f[v].context,c)}}return!0},HM_EventEmitter.prototype.on=function(e,t,n){return addListener(this,e,t,n,!1)},HM_EventEmitter.prototype.once=function(e,t,n){return addListener(this,e,t,n,!0)},HM_EventEmitter.prototype.removeListener=function(e,t,n,r){var i=prefix?prefix+e:e;if(!this._events[i])return this;if(!t)return clearEvent(this,i),this;var s=this._events[i];if(s.fn)s.fn!==t||r&&!s.once||n&&s.context!==n||clearEvent(this,i);else{for(var o=0,c=[],v=s.length;o<v;o++)(s[o].fn!==t||r&&!s[o].once||n&&s[o].context!==n)&&c.push(s[o]);c.length?this._events[i]=1===c.length?c[0]:c:clearEvent(this,i)}return this},HM_EventEmitter.prototype.removeAllListeners=function(e){var t;return e?(t=prefix?prefix+e:e,this._events[t]&&clearEvent(this,t)):(this._events=new HM_Events,this._eventsCount=0),this},HM_EventEmitter.prototype.off=HM_EventEmitter.prototype.removeListener,HM_EventEmitter.prototype.addListener=HM_EventEmitter.prototype.on,HM_EventEmitter.prototype.setMaxListeners=function(){return this},HM_EventEmitter.prefixed=prefix,HM_EventEmitter.HM_EventEmitter=HM_EventEmitter;
var CP_ERROR_MAP={read_int_val_insession:-1e3,set_selected_res_id:-1001,set_tested_bitrate:-1002,set_cur_res_id:-1003,get_bitrate_of_res_id:-1004,flash_check_failed:-1005,ajax_req_error:-1006,title_video_head_failed:-1007,title_not_video_type:-1008,play_title_video_timeout:-1009,play_title_video_failed:-1010,get_cid:-1011,get_cloudservice:-1012,get_did:-1013,get_config:-1014,stop_cloud_service:-1015,stop_all_cloud_service:-1016,multi_player:-1017,no_player_wrap:-1018,invalid_flash_bitrate:-1019,video_player_error:-1020,video_player_disconnect:-1021,input_socket_close_and_refresh_token:-1022,dont_get_cloud_service:-1023,show_player_info_failed:-1024,show_bottom_info_failed:-1025,show_notice_failed:-1026,show_upgrade_browser_info_failed:-1027,web_socket_init_failed:-1028,web_socket_check_init_failed:-1029,flash_check_end_after_player_close:-1030,set_json_map_failed:-1031,send_pay_msg_failed:-1032,require_portal_failed:-1033,get_local_key_map_failed:-1034,save_local_key_map_failed:-1035,set_flash_cookie:-1036,require_userid_error:-1037,invalid_adjx_action:-1038,set_res_list:-1039,invalid_res_list:-1040,get_name_of_res_id:-1041,set_min_bitrate:-1042,send_req_error_with_invalid_action:-1043,ajax_decrypt_error:-1044,saas_socket_check_error:-1045,input_socket_check_error:-1046,read_countly_info_in_storage_error:-1047,save_countly_info_to_storage_error:-1048,get_did_with_invalid_countly_info:-1049,init_sdk_fun_call_multi_error:-1050,start_sdk_fun_call_multi_error:-1051,show_tips_error:-1052,call_on_scene_changed_error:-1053,get_session_storage_error:-1054,show_background_img_error:-1055,record_countly_info_error:-1056,audio_load_error:-1057,eventEmitterIsNull:-1058,on_saas_message_error:-1059,on_pay_message_error:-1060,async_load_finished_multi_call:-1061,countly_module_inited_multi:-1062,js_player_inited_failed:-1063,js_player_not_inited_yet:-1064,js_player_object_not_found:-1065,input_socket_connect_multi_time:-1066,unknown_orientation:-1067,invalid_resolution_info:-1068,player_container_not_exist:-1069,game_options_param_invalid:-1070},__BASE_CODE=-8765,__hmLogWarn=function(_,e,o){try{var r=console.warn;_?console.warn(_):(r=console.log,e+=__BASE_CODE),r(gCountlyInfo.transId+"  ["+e+"]"+(o?":  "+JSON.stringify(o):""))}catch(i){}},__hmLogError=function(_,e,o){try{var r=console.error;_?console.error(_):(r=console.info,e+=__BASE_CODE),r(gCountlyInfo.transId+"  ["+e+"]"+(o?":  "+JSON.stringify(o):""))}catch(i){}};
var CP_CONSTANT={};CP_CONSTANT.CLIENT_PC=1,CP_CONSTANT.CLIENT_ANDROID=2,CP_CONSTANT.CLIENT_WEB=3,CP_CONSTANT.CLIENT_IOS=4,CP_CONSTANT.CLIENT_MAC=5,CP_CONSTANT.CLIENT_H5_IOS=6,CP_CONSTANT.CLIENT_H5_ANDROID=7,CP_CONSTANT.CLIENT_TV=8,CP_CONSTANT.OS_IPHONE="iPhone",CP_CONSTANT.OS_IPAD="iPad",CP_CONSTANT.OS_ANDROID="Android",CP_CONSTANT.DEVICE_IPHONE5="iPhone5",CP_CONSTANT.DEVICE_IPHONE5s="iPhone5s",CP_CONSTANT.DEVICE_IPHONE6="iPhone6",CP_CONSTANT.DEVICE_IPHONE6s="iPhone6s",CP_CONSTANT.DEVICE_IPHONE7="iPhone7",CP_CONSTANT.ORIENTATION_PORTRAIT="portrait",CP_CONSTANT.ORIENTATION_LANDSCAPE="landscape",CP_CONSTANT.EVENT_TOUCH_START="cp.touch_start",CP_CONSTANT.EVENT_ORIENTATION_CHANGE="cp.orientation_change",CP_CONSTANT.EVENT_PLAYER_CONNECT="cp.player_connect",CP_CONSTANT.EVENT_PLAYER_READY="cp.player_ready",CP_CONSTANT.EVENT_PLAYER_CLOSED="cp.player_closed",CP_CONSTANT.EVENT_PLAYER_ERROR="cp.player_error",CP_CONSTANT.EVENT_STOP_SDK="cp.stop_sdk_internal",CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_NORMAL=0,CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_REFRESH_TOKEN=1,CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_CHANGE_RESOLUTION=2,CP_CONSTANT.UI_MESSAGE_TYPE_UNSUPPORT="unsupport",CP_CONSTANT.UI_MESSAGE_TYPE_PORTRAIT="portrait",CP_CONSTANT.UI_MESSAGE_TYPE_LANDSCAPE="landscape",CP_CONSTANT.UI_MESSAGE_TYPE_SYSTEM="system",CP_CONSTANT.UI_MESSAGE_TYPE_IOSWECHAT="iosWeChat",CP_CONSTANT.UI_MESSAGE_TYPE_ANDROIDWECHAT="androidWeChat",CP_CONSTANT.UI_PLAYER_CONTAINER_ID="playGameBox",CP_CONSTANT.UI_PLAYER_DIV_ID="cpPlayerDivId",CP_CONSTANT.UI_PLAYER_DIV_CLASS="cpPlayerDivClass",CP_CONSTANT.API_ACTION_GET_DID="get_did",CP_CONSTANT.API_ACTION_GET_CONFIG="get_config",CP_CONSTANT.API_ACTION_GET_CID="get_cid",CP_CONSTANT.API_ACTION_GET_CLOUD_SERVICE="get_cloud_service",CP_CONSTANT.API_ACTION_STOP_CLOUD_SERVICE="stop_cloud_service",CP_CONSTANT.API_ACTION_ID_MAP={},CP_CONSTANT.API_ACTION_ID_MAP[CP_CONSTANT.API_ACTION_GET_DID]=104,CP_CONSTANT.API_ACTION_ID_MAP[CP_CONSTANT.API_ACTION_GET_CONFIG]=108,CP_CONSTANT.API_ACTION_ID_MAP[CP_CONSTANT.API_ACTION_GET_CID]=102,CP_CONSTANT.API_ACTION_ID_MAP[CP_CONSTANT.API_ACTION_GET_CLOUD_SERVICE]=201,CP_CONSTANT.API_ACTION_ID_MAP[CP_CONSTANT.API_ACTION_STOP_CLOUD_SERVICE]=202,CP_CONSTANT.CP_STOP_REASON={is_end:"time_limit",is_error:"instance_err",forced:"forced",kick_off:"no_operation",token_expire:"token_expire",logout:"log_off",disconnect:"network_off",request_error:"request_error",multi_inst:"multi_inst",low_bitrate:"low_bitrate",load_game_failed:"load_game_failed",queue_limit:"queue_limit",instance_limit:"instance_limit",verify_failed:"verify_failed",game_over:"game_over",internal_error:"internal_error",unqueue:"unqueue",unsupport_device:"unsupport_device",unsupport_privated_mode:"unsupport_privated_mode",internal:"internal"},CP_CONSTANT.SAAS_OPERATION_CODE={interval_show_queue:1,kick_off:2,is_error:3,is_end:4,playing:5,whether_to_queue:6,queue_limit:7,crash_and_rescoring:8,asking:9,be_ready:10,stoken_refresh:11,stoken_refresh:12,resume_service:13,ready_pause_server:14,pause_server:15,paused_server:16,exceed_limit:21,forced_offline:22};
function __dummyFunction(){}var CP_UTILS={};CP_UTILS.IPHONE_WEIXIN_KERNEL="WeixinAppleWebKit",CP_UTILS.ANDROID_WEIXIN_KERNEL="WeixinAndroidWebKit",CP_UTILS.getBrowser=function(n){function e(n,e){return n}function t(n,e){o=n,_=e}var r,i=navigator.userAgent.toLowerCase(),o="",_=0;return(r=i.match(/msie ([\d.]+)/))?t("Trident",e(r[1])):(r=i.match(/firefox\/([\d.]+)/))?t("Gecko",e(r[1])):(r=i.match(/chrome\/([\d.]+)/))?t("WebKit",e(r[1])):(r=i.match(/opera.([\d.]+)/))?t("Presto",e(r[1])):(r=i.match(/version\/([\d.]+).*safari/))?t("WebKit",e(r[1])):(r=i.match(/micromessenger\/([\d.]+)/))?t(CP_UTILS.detectOS()==CP_CONSTANT.OS_IPHONE?CP_UTILS.IPHONE_WEIXIN_KERNEL:CP_UTILS.ANDROID_WEIXIN_KERNEL,e(r[1])):0,"kernel"==n?o:"version"==n?_:""},CP_UTILS.detectOS=function(){var n=navigator.userAgent;if(/iPhone/i.test(n))return CP_CONSTANT.OS_IPHONE;if(/iPad/i.test(n))return CP_CONSTANT.OS_IPAD;if(/Android/i.test(navigator.userAgent))return CP_CONSTANT.OS_ANDROID;var e="Mac68K"==navigator.platform||"MacPPC"==navigator.platform||"Macintosh"==navigator.platform||"MacIntel"==navigator.platform;if(e)return"Mac";var t="X11"==navigator.platform&&!i&&!e;if(t)return"Unix";var r=String(navigator.platform).indexOf("Linux")>-1;if(r)return"Linux";var i="Win32"==navigator.platform||"Windows"==navigator.platform;if(i){var o=n.indexOf("Windows NT 5.0")>-1||n.indexOf("Windows 2000")>-1;if(o)return"Win2000";var _=n.indexOf("Windows NT 5.1")>-1||n.indexOf("Windows XP")>-1;if(_)return"WinXP";var a=n.indexOf("Windows NT 5.2")>-1||n.indexOf("Windows 2003")>-1;if(a)return"Win2003";var T=n.indexOf("Windows NT 6.0")>-1||n.indexOf("Windows Vista")>-1;if(T)return"WinVista";var O=n.indexOf("Windows NT 6.1")>-1||n.indexOf("Windows 7")>-1;if(O)return"Win7";var s=n.indexOf("Windows NT 6.2")>-1||n.indexOf("Windows 8")>-1;if(s)return"Win8";var C=n.indexOf("Windows NT 10.0")>-1||n.indexOf("Windows NT 6.4")||n.indexOf("Windows 10")>-1;if(C)return"Win10"}return"other"},CP_UTILS.isMobile=function(){for(var n=[CP_CONSTANT.OS_IPHONE,CP_CONSTANT.OS_IPAD,CP_CONSTANT.OS_ANDROID],e=CP_UTILS.detectOS(),t=0;t<n.length;t++)if(e==n[t])return!0;return!1},CP_UTILS.isInWeixin=function(){return CP_UTILS.isIniOSWeixin()||CP_UTILS.isInAndroidWeixin()},CP_UTILS.isIniOSWeixin=function(){return CP_UTILS.getBrowser("kernel")==CP_UTILS.IPHONE_WEIXIN_KERNEL},CP_UTILS.isInAndroidWeixin=function(){return CP_UTILS.getBrowser("kernel")==CP_UTILS.ANDROID_WEIXIN_KERNEL},CP_UTILS.getBasePath=function(n){var e="",t=document.getElementsByTagName("script");if(t&&t.length>0)for(var r in t)try{console.log("script: "+t[r].src);var i=t[r].src,o=i.indexOf(n);if(o>0){e=i.slice(0,o);break}}catch(_){}return e},CP_UTILS.hasOwnProperty=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},CP_UTILS.setSessionStore=function(n,e){CP_UTILS.hasOwnProperty(sessionStorage,"CLOUDPLAY")||sessionStorage.setItem("CLOUDPLAY","");var t={};return sessionStorage.CLOUDPLAY&&(t=JSON.parse(sessionStorage.CLOUDPLAY)),t[n]=e,sessionStorage.CLOUDPLAY=JSON.stringify(t),!0},CP_UTILS.getSessionStore=function(n){if(!CP_UTILS.hasOwnProperty(sessionStorage,"CLOUDPLAY")||!sessionStorage.CLOUDPLAY)return{};try{var e=JSON.parse(sessionStorage.CLOUDPLAY);return n?e[n]:e}catch(t){return __hmLogError("call getSessionStore got exception: "+t.toString(),CP_ERROR_MAP.get_session_storage_error,t.toString()),{}}},CP_UTILS.isWebsocketObject=function(n){try{return n&&(n instanceof WebSocket||n instanceof window.NativeWebSocket)}catch(e){return n}},CP_UTILS.websocket_send=function(n,e,t){n&&n.readyState==WebSocket.OPEN?n.send(e,t):console.log("invalid web_socket ")},CP_UTILS.websocket_close=function(n,e){n&&(n.onopen=__dummyFunction,n.onmessage=__dummyFunction,n.onclose=__dummyFunction,e&&n.close())},CP_UTILS.mixTips=function(n,e){for(var t=0;t<e.length;t++)n=n.replace("|",e[t]);return n.replace(/\n/g,"<br />")},CP_UTILS.orientation=function(){if(!CP_UTILS.isMobile())return CP_CONSTANT.ORIENTATION_PORTRAIT;switch(window.orientation){case 0:return CP_CONSTANT.ORIENTATION_PORTRAIT;case 180:return CP_CONSTANT.ORIENTATION_PORTRAIT;case-90:return CP_CONSTANT.ORIENTATION_LANDSCAPE;case 90:return CP_CONSTANT.ORIENTATION_LANDSCAPE;default:__hmLogWarn("unknown orientation: "+window.orientation,CP_ERROR_MAP.unknown_orientation,window.orientation)}return"unknown"},CP_UTILS.deviceType=function(){if(CP_UTILS.detectOS()==CP_CONSTANT.OS_IPHONE)try{var n,e=document.createElement("canvas"),t=e.getContext("experimental-webgl"),r=t.getExtension("WEBGL_debug_renderer_info");if(null!=r&&(n=t.getParameter(r.UNMASKED_RENDERER_WEBGL))){if(n=n.toString().toUpperCase(),n.indexOf("A6")>-1)return CP_CONSTANT.DEVICE_IPHONE5;if(n.indexOf("A7")>-1)return CP_CONSTANT.DEVICE_IPHONE5s;if(n.indexOf("A8")>-1)return CP_CONSTANT.DEVICE_IPHONE6;if(n.indexOf("A9")>-1)return CP_CONSTANT.DEVICE_IPHONE6s;if(n.indexOf("A10")>-1)return CP_CONSTANT.DEVICE_IPHONE7}}catch(i){}return"unknown"},CP_UTILS.isSupportDevice=function(){if(CP_UTILS.isMobile()){for(var n=CP_UTILS.deviceType(),e=[CP_CONSTANT.DEVICE_IPHONE5,CP_CONSTANT.DEVICE_IPHONE5s,CP_CONSTANT.DEVICE_IPHONE6,CP_CONSTANT.DEVICE_IPHONE6s,CP_CONSTANT.DEVICE_IPHONE7],t=0;t<e.length;t++)if(n==e[t])return!0;return!1}return!0},CP_UTILS.clientType=function(){return CP_UTILS.detectOS()==CP_CONSTANT.OS_IPHONE||CP_UTILS.detectOS()==CP_CONSTANT.OS_IPAD?CP_CONSTANT.CLIENT_H5_IOS:CP_UTILS.detectOS()==CP_CONSTANT.OS_ANDROID?CP_CONSTANT.CLIENT_H5_ANDROID:CP_CONSTANT.CLIENT_H5_IOS},CP_UTILS.getUrlQueryString=function(n){try{var e=window.location.search.match(new RegExp("[?&]"+n+"=([^&]+)","i"));return null==e||e.length<1?"":e[1]}catch(t){return""}},CP_UTILS.onNetworkStatus=function(n){var e=function(e){n(e)},t=function(){e(!0)},r=function(){e(!1)};window.addEventListener?(window.addEventListener("online",t,!1),window.addEventListener("offline",r,!1)):(document.body.ononline=t,document.body.onoffline=r)};
var countly_event_id_map={start_sdk:10012,input_socket_connecting:12085,input_socket_connect_opend:10021,input_socket_connect_closed:10022,input_socket_connect_failed:12049,input_socket_check_failed:12097,input_socket_start_im:12094,input_socket_stop_im:12095,input_socket_ping_pong_delay_time:10050,input_socket_ping_pong_delay_max:10033,close_by_error:10024,normal_close:10025,frame_miss:10026,out_queue:10039,fullscreen:12001,exit_fullscreen:12002,toolbar_keyboard_btn_clicked:12006,toolbar_lag_btn_clicked:12092,toolbar_unlag_btn_clicked:12093,keyboard_setting_reset:12008,keyboard_setting_save:12009,keyboard_setting_clear_all:12051,keyboard_setting_set_game_pad:12052,auto_resolution_changed_start:12011,auto_resolution_changed_done:12012,auto_resolution_changed_fail:12013,manual_resolution_changed_start:12014,manual_resolution_changed_done:12015,manual_resolution_changed_fail:12016,user_continue:12019,loading_pic_success:12020,loading_pic_fail:12021,pre_load_backgound_done:12022,pre_load_backgound_fail:12023,title_video_loading:12024,title_video_load_done:12025,title_video_load_fail:12026,title_video_play:12027,title_video_play_done:12028,title_video_play_fail:12029,speed_test_start:12030,speed_test_done:12031,speed_test_fail:12032,audio_stream_connecting:12086,audio_stream_connected:12033,audio_stream_connect_fail:12035,audio_stream_connect_disconnected:12047,video_stream_connecting:12087,video_stream_connected:12034,video_stream_connect_fail:12036,video_stream_connect_disconnected:12048,frame_delay_timeout:12038,start_revolution:12039,frame_delay_info:12042,video_url_got:12044,video_first_frame_arrived:12045,video_visible_frame_ready:12105,low_bitrate_detected:12046,init_sdk_fun_call:12058,init_sdk_fun_call_multi_error:12106,start_sdk_fun_call:12059,start_sdk_fun_call_multi_error:12107,start_sdk_fun_call_by_sdk:12109,stop_sdk_fun_Call:12053,check_flash_version_succeed:12056,check_flash_version_failed:12057,get_did_start:12063,get_did_succeed:12078,get_did_failed:12079,get_config_start:12084,get_config_succeed:12080,get_config_failed:12081,get_cid_start:12082,get_cid_succeed:12072,get_cid_failed:12073,get_clound_service_start:12083,get_clound_service_succeed:12074,get_clound_service_failed:12075,stop_clound_service_start:12091,stop_clound_service_succeed:12076,stop_clound_service_failed:12077,saas_socket_connecting:12088,saas_socket_opened:12089,saas_socket_closed:12090,saas_socket_failed:12050,saas_socket_message:12054,saas_socket_check_failed:12096,saas_socket_already_opened:12102,saas_socket_close_pre:12103,dont_get_cloud_service:12098,show_loading_view:12099,hide_loading_view:12100,show_info_page:12101,reconnecting:12104,init_websocket_module_result:12108,set_stop_mouse_send_flag:12110,page_closed:12111,countly_invalid_data_from_get_did:12112,countly_url_modified:12113,async_load_finished:12114,start_async_load:12115,device_un_support:12300,click_download:12301},countly_event_custom_error={decrypt_failed:-1e4,video_disconnect:-10001,saas_message_parser_error:-10002,video_stream_unknown_error:-10003,video_stream_load_failed:-10004,flash_load_failed:-10005,socket_close_by_self:-10006},scene_event_ids={12058:!0,12106:!0,12059:!0,12107:!0,12063:!0,12078:!0,12079:!0,12084:!0,12080:!0,12081:!0,12056:!0,12057:!0,12082:!0,12072:!0,12088:!0,12089:!0,12044:!0,10012:!0,12112:!0,12113:!0,12114:!0,12115:!0,12300:!0};window.CP_IS_COUNTLY_INITED=!1;var CP_CountlyInit=function(e){function t(){if(CP_UTILS.hasOwnProperty(sessionStorage,f))try{sessionStorage[f]&&(g=JSON.parse(sessionStorage[f]))}catch(e){__hmLogError("countlyInfoReadSessionStorage got error: "+e.toString(),CP_ERROR_MAP.read_countly_info_in_storage_error,e.toString())}}function o(){try{sessionStorage[f]=JSON.stringify(g)}catch(e){__hmLogError("countlyInfoSaveToSessionStorage got error: "+e.toString(),CP_ERROR_MAP.save_countly_info_to_storage_error,e.toString())}}function n(e){var t,o,n="",_="0123456789abcdef";for(t=0;t<8;t++)n+=_.charAt(Math.round(15*Math.random()));for(t=0;t<3;t++)for(n+="-",o=0;o<4;o++)n+=_.charAt(Math.round(15*Math.random()));n+="-";var i=(new Date).getTime();for(n+=("0000000"+i.toString(16).toUpperCase()).substr(-8),t=0;t<4;t++)n+=_.charAt(Math.round(15*Math.random()));return n+"-"+e+CP_UTILS.detectOS()+CP_UTILS.getBrowser("name")}function _(){t(),g.transId==-1&&i(CryptoJS.MD5(n((new Date).getTime()))),g.isConnected=!1}function i(e){console.info("init trans id: "+e.toString()),g.transId=e.toString(),o()}function a(){g.playId=g.playId+1,o()}function s(e){g.serverTimestamp=e,o()}function d(e){g.isConnected=e}function r(e,t){Countly.q=Countly.q||[],Countly.app_key=t,Countly.url=e,Countly.force_post=!0,Countly.fail_timeout=2,y&&(Countly.max_events=1),Countly.init()}function c(e){I||(Countly.forceSendCountlyEvent(),I=!0,setTimeout(function(){I=!1},3e3))}function l(e,t,o,n,_){p.sendCount+=1,scene_event_ids[n]&&u.emit("cp.sceneChanged","evnt",{eventId:n});var i=CP_UTILS.getSessionStore("cloud_cidinfo"),a=CP_UTILS.getSessionStore("game_options")||{},s="";i&&CP_UTILS.hasOwnProperty(i,"cid")&&CP_UTILS.hasOwnProperty(a,"userinfo")&&(s=i.cid);var d=Date.now();d<=S&&(d=S+1),S=d,_||0==_||(_="");var r={key:"HMCPWebEvent",segmentation:{key:k,timeStamp:d+"",deviceID:e,eventID:n,cloudID:s,channel:t,extraId:a.extraId,eventData:_,uid:a.userinfo?a.userinfo.uId:"",accessKeyId:o,networkType:"WIFI",netStatus:"WIFI",clientTransId:[g.transId,g.playId].join("."),serverTimestamp:g.serverTimestamp}};console.info("***** countly data (",n,") : ",r),Countly.q=Countly.q||[],Countly.q.push(["add_event",r])}if(console.info("CP_COUNTLY_INIT is call: "+CP_IS_COUNTLY_INITED),CP_IS_COUNTLY_INITED)return void __hmLogError("CP_COUNTLY_INIT call multi time",CP_ERROR_MAP.countly_module_inited_multi);window.CP_IS_COUNTLY_INITED=!0;var u=e,f="cloudplay_key_countlyInfo",g={transId:-1,playId:0,serverTimestamp:-1,isConnected:!1},y=!1,C=1e4,m=0,p={url:"",sendCount:0,countlyModuleSendCount:0,countlyModuleSucceedCount:0,countlyModuleSendFailedCount:0},v=function(){try{if(!g.isConnected)return;var e=Countly.getStatisticsInfo();p.url!=e.url&&(l(countly_event_id_map.countly_url_modified),p.url=e.url),m==p.sendCount&&p.countlyModuleSendCount==e.sendCount&&p.countlyModuleSucceedCount==e.sendSucceedCount&&p.countlyModuleSendFailedCount==e.sendFailedCount||(m=p.sendCount,p.countlyModuleSendCount=e.sendCount,p.countlyModuleSucceedCount=e.sendSucceedCount,p.countlyModuleSendFailedCount=e.sendFailedCount,p.url=e.url,u.emit("cp.sceneChanged","clst",{info:JSON.stringify(p)}))}catch(t){__hmLogError("recordCountlyStatisticsInfo got error: "+t.toString(),CP_ERROR_MAP.record_countly_info_error,t.toString())}};_();var I=!1,S=0,k=CP_UTILS.clientType();return _(),{setServerInfo:function(e,t,o){g.isConnected||(s(o),d(!0),r(e,t),y&&(p.url=e,v()))},startRecordStatisticInfo:function(){y||(y=!0,setInterval(v,C))},sessionId:function(){return[g.transId,g.playId].join(".")},incPlayId:a,sendCountly:l,forceSendCountlyEventWhenClosed:c}};
var _cpIE8CorsAjax=function(t){try{console.log("start new ie8/9 cors ajax operation: "+t.url);var e=new XDomainRequest;/^\d+$/.test(t.timeout)&&(e.timeout=t.timeout),e.ontimeout=function(){t.done(!1,"timeout")},e.onload=function(){t.done(!0,e.responseText)},e.onprogress=function(){},e.onerror=function(){t.done(!1,"onerror: "+e.responseText)},t.data&&(postData=t.data),e.open(t.method,t.url),e.send(t.data)}catch(o){t.done(!1,"Exception: "+o.toString())}},__cp_ajax=function(t){try{var e=window.XMLHttpRequest?new window.XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null;"GET"===t.method?e.open("GET",t.url,!0):(e.open("POST",t.url,!0),e.setRequestHeader("Content-type",t.contentType)),e.onreadystatechange=function(){4===this.readyState&&this.status>=200&&this.status<300?t.done(!0,e.responseText):4===this.readyState&&t.done(!1,"invalid status: "+this.status)},"GET"==t.method?e.send():e.send(t.data)}catch(o){t.done(!1,"Exception: "+o.toString())}},cloudplay_ajax=function(t){var e=1;if(t&&CP_UTILS.hasOwnProperty(t,"tryCount")&&(e=parseInt(t.tryCount)),e<=1)return console.log("start new ajax operation tryCount: 1, url: "+t.url),void __cp_ajax(t);var o=500;t&&CP_UTILS.hasOwnProperty(t,"retryInterval")&&(o=parseInt(t.retryInterval));var n=t.done,r=function(r,a){return r?(t.done=n,void n(!0,a)):(e-=1,0==e?(t.done=n,void n(!1,a)):void setTimeout(function(){console.log("start retry ajax operation tryCount: "+e+", url: "+t.url),__cp_ajax(t)},o))};t.done=r,console.log("start new ajax operation tryCount: "+e+", url: "+t.url),__cp_ajax(t)};
function CP_isPortraitGame(){var e=CP_UTILS.getSessionStore("game_options");return e&&e.isPortrait}function CP_getClass(e,t){if(document.getElementsByClassName)return document.getElementsByClassName(t);var n=document.getElementsByTagName(e),d=[];return n[i]["class"]==t&&(d[d.length]=n[i]),d}function CP_showLoadingView(e){for(var e=e,t=CP_getClass("div","backgroundCover"),n=document.getElementById("playGameBox"),d=t.length-1;d>=0;d--)n.removeChild(t[d]);Cloudplay.sendCountly(countly_event_id_map.show_loading_view);var i=document.getElementById("loadingBox");if(null==i){var a=document.createElement("div");a.setAttribute("class","c1");var l=document.createElement("div");l.setAttribute("class","c2");var o=document.createElement("div");o.setAttribute("class","c3");var r=document.createElement("div");r.setAttribute("class","c4");var c=document.createElement("span"),m=document.createTextNode("loading");c.appendChild(m);var s=document.createElement("div");s.appendChild(a),s.appendChild(l),s.appendChild(o),s.appendChild(r);var u=document.createElement("div");u.setAttribute("class","loading"),u.setAttribute("id","loadingBox"),u.appendChild(s),u.appendChild(c),n.appendChild(u);var g=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,v=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,p=(v-g)/2;if("startSDK"!=e){var C=CP_isPortraitGame();if("false"==C||0==C){var i=document.getElementById("loadingBox");i.setAttribute("class","loading rotate90"),i.setAttribute("style","width:"+v+"px; height:"+g+"px;left:-"+p+"px;top:"+p+"px;")}}}}function CP_hideLoadingView(){Cloudplay.sendCountly(countly_event_id_map.hide_loading_view);var e=document.getElementById("loadingBox");if(null!=e){var t=document.getElementById("playGameBox");t.removeChild(e)}}
var _CP_loadScript=function(e,o,a,l){var n=document.createElement("script");n.src=e;var d=document.getElementsByTagName("head")[0],r=!1;n.onload=n.onreadystatechange=function(){r||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(r=!0,l(e,o,!0),n.onload=n.onreadystatechange=null,a&&d.removeChild(n))},d.appendChild(n)},CP_AsyncLoadJsFiles=function(e,o,a,l){if(console.info("[async_loader] start load js files, count: "+e.length+", isInSerial: "+o),o){var n=function(o,d,r){return r?(console.info("[async_loader] load js file succeed, url: "+o),d+=1,d<e.length?void _CP_loadScript(e[d],d,a,n):(console.info("[async_loader] all loaded finished"),void l(!0))):(console.error("[async_loader] load js file failed, url: "+o),void l(!1))};return void _CP_loadScript(e[0],0,a,n)}for(var d=[],r=0;r<e.length;r++)d.push(!1),_CP_loadScript(e[r],r,a,function(o,a,n){if(!n)return console.error("[async_loader] load js file failed, url: "+o),void l(!1);console.info("[async_loader] load js file succeed, url: "+o),d[a]=!0;for(var r=!0,i=0;i<e.length;i++)if(!d[i]){r=!1;break}r&&(console.info("[async_loader] all loaded finished"),l(!0))})},CP_AsyncLoadCssFiles=function(e,o,a){};
var Cloudplay=function(e,o){function n(){return Ce||(Ce=localStorage.cloud_did),Ce}function t(e){console.info("set new device id: "+e+", gDeviceId: "+Ce+", localStorage.cloud_did: "+localStorage.cloud_did),localStorage.cloud_did=e,Ce=e}function _(e){var o="abcdefghijklmnopqrstuvwxyz0123456789";e=e||16;for(var n="",t=0;t<e;t++)n+=o.charAt(Math.floor(Math.random()*o.length));return n}function i(e,n){var t=o.enc.Utf8.parse(n),_=o.AES.encrypt(e,t,{mode:o.mode.ECB,padding:o.pad.Pkcs7});return _.toString()}function a(e,n){var t=o.enc.Utf8.parse(n),_=o.AES.decrypt(e,t,{mode:o.mode.ECB,padding:o.pad.Pkcs7});return o.enc.Utf8.stringify(_)}function r(e,o){var n={};return n[CP_CONSTANT.API_ACTION_GET_DID]=countly_event_id_map.get_did_failed,n[CP_CONSTANT.API_ACTION_GET_CONFIG]=countly_event_id_map.get_config_failed,n[CP_CONSTANT.API_ACTION_GET_CID]=countly_event_id_map.get_cid_failed,n[CP_CONSTANT.API_ACTION_GET_CLOUD_SERVICE]=countly_event_id_map.get_clound_service_failed,n[CP_CONSTANT.API_ACTION_STOP_CLOUD_SERVICE]=countly_event_id_map.stop_clound_service_failed,CP_UTILS.hasOwnProperty(n,e)?void pe(n[e],o?o:-1):void __hmLogError("sendReqFailedCountlyEvent got invalid action: "+e,CP_ERROR_MAP.send_req_error_with_invalid_action,[e,o])}function s(e,o,t,s){if(!(o in CP_CONSTANT.API_ACTION_ID_MAP))return __hmLogWarn("invalid action:"+o,CP_ERROR_MAP.invalid_adjx_action,[e,o]),!1;var c=navigator||{},d={hardDecoderSupported:"1",osName:CP_UTILS.detectOS(),osVersion:CP_UTILS.detectOS(),webInfo:{installLocSignYN:"",cookieId:"",userAgent:c.userAgent,browserType:c.vendor,platform:c.platform,browserVersion:CP_UTILS.getBrowser("version"),browserKernel:CP_UTILS.getBrowser("kernel"),browserKernelVersion:navigator.appVersion.substring(navigator.appVersion.lastIndexOf("/")+1,navigator.appVersion.length),flashPlayerVersion:-1},screenInfo:{dpi:"",resolution:window.screen.width+"*"+window.screen.height}},l={accessKeyID:de,packageName:"haima",sdkVersion:SDK_VERSION,channel:ce},u="",S="";if(o===CP_CONSTANT.API_ACTION_GET_DID||o===CP_CONSTANT.API_ACTION_GET_CID||o===CP_CONSTANT.API_ACTION_GET_CONFIG)S=_(),u=B+S;else{var C=CP_UTILS.getSessionStore("cloud_cidinfo")||{};u=C.secret_key,S=C.cid}console.log("------ action : "+o+" random : "+S+" key : "+u);var t={action:{actId:CP_CONSTANT.API_ACTION_ID_MAP[o],transId:(new Date).getTime()+_(4)||1,protocol:Q,random:S,sdkType:x,did:n()||"",clientTransId:D.sessionId()},data:i(JSON.stringify(t),u),device:i(JSON.stringify(d),u),client:i(JSON.stringify(l),u)},T={url:e,data:JSON.stringify(t),method:"POST",contentType:"text/plain",tryCount:o==CP_CONSTANT.API_ACTION_GET_DID||o==CP_CONSTANT.API_ACTION_GET_CONFIG?3:1,done:function(n,t){if(n){var _=JSON.parse(t);if(0===_.code)try{_.data=JSON.parse(a(_.data,u))}catch(i){__hmLogError("ajax decrypt action: "+o+"error: "+i.toString(),CP_ERROR_MAP.ajax_decrypt_error,[o,i.toString()]),_.code=countly_event_custom_error.decrypt_failed}return void s(_)}ve=!1,__hmLogWarn("ajax error : "+t+", url: "+e+", action: "+o,CP_ERROR_MAP.ajax_req_error,[e,o,t]),r(o,t),o!==CP_CONSTANT.API_ACTION_STOP_CLOUD_SERVICE&&N(H.prompt_network_unavailable?H.prompt_network_unavailable:Se,V,!1,CP_CONSTANT.CP_STOP_REASON.request_error)}};cloudplay_ajax(T)}function c(e,o,n){if(!e||!o)return{};var t={};for(var _ in e){var i=e[_];if(i&&i.hasOwnProperty(o)){var _=i[o];n?t[_]=i[n]||"":t[_]=i}}return t}function d(e,o,t,_,i){if(pe(countly_event_id_map.get_cid_start),le=CP_UTILS.getSessionStore("cloud_cidinfo"),le&&CP_UTILS.hasOwnProperty(le,"cid")&&le.cid)return $=!0,W==CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_NORMAL&&(W=CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_REFRESH_TOKEN),console.log("get cid cidinfo is in storage already: "+JSON.stringify(le)),pe(countly_event_id_map.get_cid_succeed,1),w.emit("cp.get_cid_done",le),i(le.cid);if(!n())return void u(t);var a=CP_UTILS.getSessionStore("game_options"),c=SAAS_AUTH,d={did:n(),type:x,userInfo:e,configInfo:o,pkgName:t,extraId:a.extraId,envType:envType,CToken:_};s(c,CP_CONSTANT.API_ACTION_GET_CID,d,function(e){if(ee=!1,0===e.code){console.log("get cid info done, cid info: "+JSON.stringify(e.data)),pe(countly_event_id_map.get_cid_succeed,0);var o=e.data,n={cid:o.cidId,saas_ws:o.msgServInfo&&o.msgServInfo.socketUrl,secret_key:o.secretKey,sign:o.sign,resolutionInfo:o.resolutionInfo,minimumBitRate:o.minimumBitRate};return w.emit("cp.get_cid_done",n),i(e.data.cid)}__hmLogError("get_cid error:"+e.code+", "+e.msg,CP_ERROR_MAP.get_cid,e.code),r(CP_CONSTANT.API_ACTION_GET_CID,e.code),10201===e.code?(localStorage.removeItem("cloud_did"),ee=!0,u(t)):10202===e.code?N("已超过多开上限，请关闭此页面",V,!1,CP_CONSTANT.CP_STOP_REASON.instance_limit):N("账号验证失败",V,!1,CP_CONSTANT.CP_STOP_REASON.verify_failed)})}function l(e,o){if(!e)return void console.log("[RES] getCloudService waiting cidinfo......");pe(countly_event_id_map.get_clound_service_start);var n=CP_UTILS.getSessionStore("game_options")||{},t=SAAS_AUTH,_={resId:123,cid:e.cid,sign:e.sign,priority:n.priority||0,confirm:o||0,clientType:x,orientation:1,playingtime:n.playingtime,opType:W,envType:envType,payStr:n.payStr||"",deviceType:CP_UTILS.deviceType()};if(U&&U.isUserSelectedResMode())_.resolution=U.curResId(),console.log("[RES] getCloudService with resId: "+_.resolution);else{var i=-1;_.bitRate=i,console.log("[RES] getCloudService with kiloByte: "+_.bitRate)}s(t,CP_CONSTANT.API_ACTION_GET_CLOUD_SERVICE,_,function(e){console.log("[RES] getCloudService got response: ",e),0===e.code?(pe(countly_event_id_map.get_clound_service_succeed),w.emit("cp.cloud_service_ready",e.data.resultId)):(r(CP_CONSTANT.API_ACTION_GET_CLOUD_SERVICE,e.code),setTimeout(function(){N(e.msg,V,!1,CP_CONSTANT.CP_STOP_REASON.internal_error)},3e3),__hmLogError("get_cloud_service error:"+e.code+", "+e.msg,CP_ERROR_MAP.get_cloudservice,e.code))})}function u(e){var o=n()||0,_=SAAS_AUTH,i={did:o,envType:envType,type:x};pe(countly_event_id_map.get_did_start),s(_,CP_CONSTANT.API_ACTION_GET_DID,i,function(o){0===o.code&&o.data?(o.data.countlyUrl&&o.data.countlyAppKey&&o.data.serverTimestamp?D.setServerInfo(o.data.countlyUrl,o.data.countlyAppKey,o.data.serverTimestamp):(pe(countly_event_id_map.countly_invalid_data_from_get_did),__hmLogError("get_did error:"+o.msg,CP_ERROR_MAP.get_did_with_invalid_countly_info,[o.data.countlyUrl,o.data.countlyAppKey,o.data.serverTimestamp])),pe(countly_event_id_map.get_did_succeed),t(o.data.did),w.emit("cp.reg_sdk_done",o.data.did,e)):(__hmLogError("get_did error:"+o.msg,CP_ERROR_MAP.get_did,o.code),r(CP_CONSTANT.API_ACTION_GET_DID,o.code),N(o.msg?o.msg:Se,V,!1,CP_CONSTANT.CP_STOP_REASON.internal_error))})}function S(e,o){var n={accessKeyId:de,packageName:e,type:o||0,envType:envType};pe(countly_event_id_map.get_config_start),s(SAAS_AUTH,CP_CONSTANT.API_ACTION_GET_CONFIG,n,function(o){if(0===o.code&&o.data){pe(countly_event_id_map.get_config_succeed);var n=o.data;if(console.log("************* get Configure:",n),q=c(n.setDataInfo,"k","v"),re=n,H=c(n.interactiveTalkInfo,"k","v"),console.log("saas_operation_tips:",H),F=n.tipsInfo,U&&(U.setAuthData(n,H,F,q),!CP_UTILS.isSupportDevice()))return void U.showMessageView(CP_CONSTANT.UI_MESSAGE_TYPE_UNSUPPORT);w.emit("cp.get_auth_config_done",e)}else __hmLogError("get_config error:"+o.code+", "+o.msg,CP_ERROR_MAP.get_config,o.code),r(CP_CONSTANT.API_ACTION_GET_CONFIG,o.code),N(o.msg?o.msg:Se,V,!1,CP_CONSTANT.CP_STOP_REASON.internal_error)})}function C(){if(!CP_UTILS.hasOwnProperty(sessionStorage,"CLOUDPLAY"))return!1;var e=JSON.parse(sessionStorage.CLOUDPLAY);return!!CP_UTILS.hasOwnProperty(e,"cloud_cidinfo")&&e.cloud_cidinfo}function T(e){return console.info("init sdk is call, pkg_name: "+e.pkg_name),e&&(de=e.accessKeyID,ce=e.channelId),ge||C()||D.incPlayId(),ge?(pe(countly_event_id_map.init_sdk_fun_call_multi_error),void __hmLogError("init sdk call multi time",CP_ERROR_MAP.init_sdk_fun_call_multi_error)):(e&&CP_UTILS.hasOwnProperty(e,"recordCountlyStatisticsInfo")&&e.recordCountlyStatisticsInfo&&D.startRecordStatisticInfo(),e.onSceneChanged&&w.on("cp.sceneChanged",function(o,n){try{console.log("onSceneChanged got scene: "+o+", info: "+(n?JSON.stringify(n):"null")),e.onSceneChanged(o,n)}catch(t){__hmLogError("call onSceneChanged got exception: "+t.toString(),CP_ERROR_MAP.call_on_scene_changed_error,t.toString())}}),pe(countly_event_id_map.init_sdk_fun_call),ge=!0,CP_UTILS.hasOwnProperty(e,"accessKeyID")?CP_UTILS.hasOwnProperty(e,"channelId")?CP_UTILS.hasOwnProperty(e,"MessageHandler")?(e.MessageHandler&&(se=e.MessageHandler),w.emit("cp.sceneChanged","init"),u(e.pkg_name)):void v("初始化错误:messageHandler 未定义"):void v("初始化错误:channelId 未定义"):void v("初始化错误:accessKeyID 未定义"))}function p(e,o){var t=CP_UTILS.getSessionStore("game_options")||{};le=CP_UTILS.getSessionStore("cloud_cidinfo")||{};var _=t.userinfo||{},i=e+"/websocket?did="+n()+"&cid="+le.cid+"&uid="+_.uId+"&appId="+de+"&sign="+le.sign;g(i)}function g(o,n){if(console.log("saas_socket start connect, gIsStoped: "+b+", gIsOnline: "+M+", saas_retry_time: "+n+", url: "+o),!b&&M){if(pe(countly_event_id_map.saas_socket_connecting),n>z)return pe(countly_event_id_map.saas_socket_failed),void N(H.prompt_crash,V,!1,CP_CONSTANT.CP_STOP_REASON.internal_error);ue=new e(o);var t=ue;ue.onopen=function(){if(ue!=t)return pe(countly_event_id_map.saas_socket_check_failed,"onopen"),void __hmLogError("saas_socket onopen socket check error",CP_ERROR_MAP.saas_socket_check_error,"onopen");if(pe(countly_event_id_map.saas_socket_opened),console.log("Saas Websocket 连接建立成功"),n>0&&(n=0),null==Oe&&(Oe=setInterval(function(){CP_UTILS.websocket_send(ue,"")},1e4)),ne){var e=U&&U.isPlayerRunning();return __hmLogWarn("cloud_service_ready is true, don't need to getCloudService(), isPlaying: "+e,CP_ERROR_MAP.dont_get_cloud_service,e),void pe(countly_event_id_map.dont_get_cloud_service,e)}var o=CP_UTILS.getSessionStore("cloud_cidinfo");l(o)},n=n||0,ue.onclose=function(e){if(ue!=t)return pe(countly_event_id_map.saas_socket_check_failed,"onclose"),void __hmLogError("saas_socket onclose socket check error",CP_ERROR_MAP.saas_socket_check_error,"onclose");var _=e&&e.code?e.code:-1;pe(countly_event_id_map.saas_socket_closed,_),b||(console.log("saas_socket connect close! code:"+e.code),clearInterval(Oe),Oe=null,fe=setTimeout(function(){console.log("saas_socket reconnecting ..."),g(o,n+1)},1e3+2e3*n))},ue.onmessage=function(e){if(console.log("saas_socket got a Message:"+e.data.toString()),ue!=t)return pe(countly_event_id_map.saas_socket_check_failed,"onmessage"),void console.log("saas_socket onmessage socket check error");var o=null;try{o=JSON.parse(e.data);var n=[],_=null;if(n.push(o.type),2===o.type?(_=JSON.parse(o.payload),n.push(_.operation)):n.push(encodeURIComponent(o.payload)),n.push(o.ack),n.push(o.mid),n.push(o.to),pe(countly_event_id_map.saas_socket_message,n.join(",")),0===o.ack){if(1===o.type&&se){try{console.log("saas_socket got special message: "+(o?JSON.stringify(o):"null")),se(o)}catch(i){__hmLogError("saas_socket onSaasMessage call got error: "+i.toString(),CP_ERROR_MAP.on_pay_message_error,i.toString())}return}if(2===o.type)switch(_.operation){case CP_CONSTANT.SAAS_OPERATION_CODE.exceed_limit:N(H.toast_open_same_game,V,!1,CP_CONSTANT.CP_STOP_REASON.multi_inst);break;case CP_CONSTANT.SAAS_OPERATION_CODE.forced_offline:N(H.tips_forced_offline_action,V,!1,CP_CONSTANT.CP_STOP_REASON.token_expire);break;case CP_CONSTANT.SAAS_OPERATION_CODE.playing:te=!0;var a=_.data;ve=!1,pe(countly_event_id_map.video_url_got,a.videoUrl),w.emit("cp.get_rtmp_addr",a);break;case CP_CONSTANT.SAAS_OPERATION_CODE.interval_show_queue:if(Pe&&_.data.index>=Pe)return;Pe=_.data.index;var r=CP_UTILS.mixTips(H.prompt_wait_man_time,[_.data.index]);r=r.replace("|",[_.data.timeStr]),r=_.data.timeStr?r.replace("|",[_.data.timeStr]):CP_UTILS.mixTips(H.prompt_wait_message,[_.data.index]),v(r,!0),w.emit("cp.sceneChanged","wait");break;case CP_CONSTANT.SAAS_OPERATION_CODE.asking:v(H.toast_instance_apply,!0);break;case CP_CONSTANT.SAAS_OPERATION_CODE.be_ready:break;case CP_CONSTANT.SAAS_OPERATION_CODE.whether_to_queue:var r=CP_UTILS.mixTips(H.toast_wait_choose,[_.data.index]);A(r);break;case CP_CONSTANT.SAAS_OPERATION_CODE.is_error:var r=H.prompt_hmcp_error;N(r,G,!1,CP_CONSTANT.CP_STOP_REASON.is_error);break;case CP_CONSTANT.SAAS_OPERATION_CODE.crash_and_rescoring:var r=H.prompt_crash;v(r),w.emit("cp.reconnect",-1);break;case CP_CONSTANT.SAAS_OPERATION_CODE.is_end:var r=H.prompt_game_over;N(r,V,!1,CP_CONSTANT.CP_STOP_REASON.is_end);break;case CP_CONSTANT.SAAS_OPERATION_CODE.kick_off:var r=H.toast_no_input;N(r,G,!1,CP_CONSTANT.CP_STOP_REASON.kick_off);break;case CP_CONSTANT.SAAS_OPERATION_CODE.queue_limit:var r=H.toast_wait_tooMany;N(r,G,!1,CP_CONSTANT.CP_STOP_REASON.queue_limit);break;case CP_CONSTANT.SAAS_OPERATION_CODE.stoken_refresh:break;case CP_CONSTANT.SAAS_OPERATION_CODE.resume_service:var r=H.tips_saas_service_resume;N(r,G,!1),w.emit("cp.sceneChanged","mait",{progress:"done"});break;case CP_CONSTANT.SAAS_OPERATION_CODE.ready_pause_server:var r=CP_UTILS.mixTips(H.tips_saas_ready_to_stop,[_.data.timeStr]);I(r),w.emit("cp.sceneChanged","mait",{progress:"soon"});break;case CP_CONSTANT.SAAS_OPERATION_CODE.pause_server:if(U&&U.isPlayerRunning())break;var r=H.tips_saas_to_stop;N(r,V,!1),w.emit("cp.sceneChanged","mait",{progress:"soon"});break;case CP_CONSTANT.SAAS_OPERATION_CODE.paused_server:var r=CP_UTILS.mixTips(H.tips_saas_already_stopped,[_.data.endTimeText]);N(r,V,!1),w.emit("cp.sceneChanged","mait",{progress:"start"})}}}catch(i){__hmLogError("saas_socket onmessage call got error: "+i.toString(),CP_ERROR_MAP.on_saas_message_error,i.toString()),pe(countly_event_id_map.saas_socket_message,["InvalidType",countly_event_custom_error.saas_message_parser_error].join(","))}}}}function P(e,o){if(console.info("start sdk is call by "+(o?"sdk":"app")+", pkg_name: "+e.pkg_name),e.isPortrait!==!0&&e.isPortrait!==!1)return void __hmLogError("options.isPortrait value is invalid,it must be true or false",CP_ERROR_MAP.game_options_param_invalid);if(pe(o?countly_event_id_map.start_sdk_fun_call_by_sdk:countly_event_id_map.start_sdk_fun_call),!CP_UTILS.isSupportDevice())return console.info("start sdk is stop for device is not support"),void pe(countly_event_id_map.device_un_support,[CP_UTILS.detectOS(),CP_UTILS.deviceType()].join(","));if(!o){if(Ae)return pe(countly_event_id_map.start_sdk_fun_call_multi_error),void __hmLogError("start sdk call multi time",CP_ERROR_MAP.start_sdk_fun_call_multi_error);Ae=!0}var n=CP_UTILS.getSessionStore("game_options");return n&&n.pkg_name&&e.pkg_name!==n.pkg_name&&(console.info("start sdk is call by "+(o?"sdk":"app")+", stop previouse pkg_name: "+n.pkg_name+" and new: "+e.pkg_name),N("",V,!1)),b=!1,console.log("this is KeyPicUrl:"+q.key_map_image_url),CP_UTILS.setSessionStore("game_options",e),Z?(le=CP_UTILS.getSessionStore("cloud_cidinfo"),le||pe(countly_event_id_map.start_sdk),le&&($=!0),CP_showLoadingView("startSDK"),d(e.userinfo,e.configinfo,e.pkg_name,e.c_token,function(e){return e}),void(ee=!1)):void console.info("start sdk is call by "+(o?"sdk":"app")+", but wait reg_sdk done, pkg_name: "+e.pkg_name)}function O(e){var o=SAAS_AUTH,n={cid:e,envType:envType};pe(countly_event_id_map.stop_clound_service_start),s(o,CP_CONSTANT.API_ACTION_STOP_CLOUD_SERVICE,n,function(o){0===o.code?(console.log("stop_cloud_service succeed, cid: "+e),pe(countly_event_id_map.stop_clound_service_succeed)):(__hmLogWarn("stop_cloud_service fail, cid: "+e+", error: "+o.msg,CP_ERROR_MAP.stop_cloud_service,o.code),r(CP_CONSTANT.API_ACTION_STOP_CLOUD_SERVICE,o.code))})}function f(e){var o={interval:(Date.now()-Y)/1e3,reason:e};w.emit("cp.sceneChanged","stop",o)}function N(e,o,n,t){console.info("stop sdk is call by "+(n?"app":"sdk")+", flag: "+o+", stopReason: "+(t?t:"null")+", notice: "+(e?e:"null")),pe(countly_event_id_map.stop_sdk_fun_Call,n?0:1),w.off(CP_CONSTANT.EVENT_PLAYER_ERROR);var _=CP_UTILS.getSessionStore("cloud_cidinfo");if(oe=null,_e=null,ie=null,ae=-1,ne=!1,fe&&(clearInterval(fe),fe=null),Oe&&(clearInterval(Oe),Oe=null),CP_UTILS.isWebsocketObject(ue)&&(console.log("saas_socket close"),CP_UTILS.websocket_close(ue,!0),ue=void 0,pe(countly_event_id_map.saas_socket_closed,countly_event_custom_error.socket_close_by_self)),CP_hideLoadingView(),U?U.stop(e):e&&v(e),t&&f(t),o!=K){var i=_&&_.cid?_.cid+"":null,a=Ne();if(i&&a.hasOwnProperty(i)&&(delete a[i],localStorage.cloudplay_cids=JSON.stringify(a)),b=!0,!i)return void console.log("云玩已关闭");O(_.cid),o===G?CP_UTILS.setSessionStore("cloud_cidinfo",null):sessionStorage.removeItem("CLOUDPLAY")}}function m(){if(_e=null,ie=null,ne&&oe){if(!U)return;w.off(CP_CONSTANT.EVENT_PLAYER_ERROR).on(CP_CONSTANT.EVENT_PLAYER_ERROR,function(){console.warn("player got some error, we need to reconnect it, isStop: "+b),b||w.emit("cp.reconnect",CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_REFRESH_TOKEN)});try{var e=oe.resolutionInfo.resolution,o=e.indexOf("x");oe.vedioWidth=parseInt(e.substring(0,o)),oe.vedioHeight=parseInt(e.substring(o+1))}catch(n){return __hmLogError("invalid resolutionInfo: "+JSON.stringify(oe),CP_ERROR_MAP.invalid_resolution_info,JSON.stringify(oe)),void N("游戏分辨率参数非法",V,!1,CP_CONSTANT.CP_STOP_REASON.internal_error)}U.hideMessageView(),U.startPlay(oe)}}function v(e,o){_e=null,ie=null,oe=null,U?U.showMessageView(CP_CONSTANT.UI_MESSAGE_TYPE_SYSTEM,e):o?_e=e:alert(e)}function A(e){if(!J)return void N(H.toast_wait_tooMany,V,!1,CP_CONSTANT.CP_STOP_REASON.queue_limit);if(_e=null,ie=null,oe=null,U){var o=function(){pe(countly_event_id_map.user_continue);var e=CP_UTILS.getSessionStore("cloud_cidinfo");e?(w.emit("cp.sceneChanged","wait"),l(e,1)):v("排队信息丢失,请刷新重试")},n=function(){D.sendCountly(countly_event_id_map.out_queue),console.log("cancel"),N("",V,!1,CP_CONSTANT.CP_STOP_REASON.unqueue)};U.askQueuing(e,o,n),w.emit("cp.sceneChanged","askn")}else ie=e}function I(e){U&&U.showWarnToast(e)}function E(e){if(!ue)return void __hmLogWarn("saas_socket is not connect!",CP_ERROR_MAP.send_pay_msg_failed);var o={uid:e.uid,to:e.from,from:e.to,mid:"W"+Date.now(),type:1,ack:0,payload:e.payload};CP_UTILS.websocket_send(ue,"Message",o),console.log("pay message emitted:"+JSON.stringify(o))}function y(){var e=H.prompt_game_over?H.prompt_game_over:"游戏结束, 感谢使用";N(e,V,!0)}function R(){U&&U.stopPlay(!0)}function k(){R(),pe(countly_event_id_map.page_closed,"unload"),D.forceSendCountlyEventWhenClosed("unload")}function h(){if(console.info("js async load finished, gErrorMsg: "+_e+", gInQueueMsg: "+ie+", rtmp_options: "+(oe?JSON.stringify(oe):"null")+", gCurrentResId: "+ae),U)return void __hmLogError("_asyncLoadFinished multi call",CP_ERROR_MAP.async_load_finished_multi_call);try{U=CP_CloudplayUIInit(jQuery)}catch(e){return console.info("js async load finished, but something is not ready yet: "+e.toString()),void setTimeout(function(){h()},1e3)}return pe(countly_event_id_map.async_load_finished),re&&U.setAuthData(re,H,F,q),CP_UTILS.isSupportDevice()?(ae!=-1&&(U.setCurrentResId(ae),ae=-1),oe?(U.connectInputSocket(oe.inputUrl,oe.inputProtocol),void m()):_e?void v(_e):ie?void A(ie):void 0):(N("",V,!1,CP_CONSTANT.CP_STOP_REASON.unsupport_device),void U.showMessageView(CP_CONSTANT.UI_MESSAGE_TYPE_UNSUPPORT))}function L(){pe(countly_event_id_map.start_async_load);var e=CP_UTILS.getBasePath("saas-sdk.js");if(console.info("start js async load, gIsStartAsyncLoad: "+Ie+", base path: "+e),!Ie){Ie=!0;var o=[e+"jquery-3.1.0.js",e+"jquery-ui.js",e+"saas-player.js",e+"saas-ui.js"];CP_AsyncLoadJsFiles(o,!0,!0,function(e){e?(console.info("load js files succeed"),h()):console.error("load js files FAILED")})}}window.SDK_VERSION="feature-mobile_h5_sdk-fcfd16cf",console.info("------------- WEB H5 SDK_VERSION: ",SDK_VERSION);var U=null,w=new HM_EventEmitter,D=CP_CountlyInit(w),b=!0,M=!0;Date.now||(Date.now=function(){return(new Date).valueOf()});var V=0,G=1,K=2,x=CP_UTILS.clientType();if(console.info("detect OS: "+CP_UTILS.detectOS()+", client type: "+x+", "+(CP_UTILS.isMobile()?"IS":"NOT")+" mobile system, "+(CP_UTILS.isInWeixin()?"IS":"NOT")+" in weixin"),console.info("detect DEVICE: "+CP_UTILS.deviceType()),console.info("detect BROWSER: "+navigator.userAgent+", kernel: "+CP_UTILS.getBrowser("kernel")+", version: "+CP_UTILS.getBrowser("version")),"object"==typeof localStorage)try{localStorage.setItem("localStorage",1),localStorage.removeItem("localStorage")}catch(j){setTimeout(function(){N('不能在"无痕模式"下进行游戏',V,!1,CP_CONSTANT.CP_STOP_REASON.unsupport_privated_mode)},3e3)}var J=!CP_UTILS.isMobile(),Y=0,H={},F={},W=CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_NORMAL,q={},B="web0123456789012",Q="3.0.11",z=5,X=5,Z=!1,$=!1,ee=!1,oe=null,ne=!1,te=!1,_e=null,ie=null,ae=-1,re=null,se=void 0,ce="",de="",le=void 0,ue=void 0,Se="网络异常，请重新连接",Ce=localStorage.cloud_did;if(console.info("init gDeviceId id: "+Ce),CP_UTILS.isMobile()){console.info("init and current orientation: "+CP_UTILS.orientation()),window.onorientationchange=function(){var e=CP_UTILS.orientation();console.log("orientation changed to: "+e),w.emit(CP_CONSTANT.EVENT_ORIENTATION_CHANGE,e)};var Te=0;document.addEventListener("visibilitychange",function(){if(console.log("page change to: "+document.visibilityState),!b&&CP_UTILS.detectOS()==CP_CONSTANT.OS_IPHONE)if("visible"==document.visibilityState){var e=Te>0&&(new Date).getTime()-Te<3e4;e?console.log("page change to visible and do REFRESH_TOKEN reconnect logic"):(console.log("page change to visible and do NORMAL reconnect logic"),ve||CP_UTILS.setSessionStore("cloud_cidinfo",null)),CP_showLoadingView(),setTimeout(function(){w.emit("cp.reconnect",e?CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_REFRESH_TOKEN:CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_NORMAL)},1e3),Te=0}else ne&&(Te=(new Date).getTime()),N("",K,!1)})}CP_UTILS.onNetworkStatus(function(e){console.info("network online status from: "+M+", changed to: "+e+", gIsStoped: "+b),M=e,b||(M===!0?w.emit("cp.reconnect",CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_REFRESH_TOKEN):N("连接出错,联网后会自动重连",K,!1,CP_CONSTANT.CP_STOP_REASON.disconnect))});var pe=function(e,o){D.sendCountly(n(),ce,de,e,o)},ge=!1,Pe=null,Oe=null,fe=null;w.on("cp.reg_sdk_done",function(e,o){console.log("get device id done, did:"+e),S(o)}),w.on("cp.get_auth_config_done",function(e){var o=CP_UTILS.getSessionStore("game_options");Z=!0,Ae&&e&&o&&o.pkg_name===e?(console.log("get auth config done and auto startSDK(), pkg_name: "+e),P(o,!0)):console.log("get auth config done, and dont auto startSDK() for gIsCallStartSDK: "+Ae+", pkg_name: "+e+", game_options.pkg_name: "+(o?o.pkg_name:"null"))});var Ne=function(){try{var e=JSON.parse(localStorage.cloudplay_cids);return e?e:{}}catch(o){return{}}};w.on("cp.get_cid_done",function(o){if(CP_UTILS.setSessionStore("cloud_cidinfo",o),o.cid){var n=Ne();n[o.cid]=o.secret_key,localStorage.cloudplay_cids=JSON.stringify(n)}if(CP_UTILS.isWebsocketObject(ue)){if(ue.readyState==e.OPEN)return pe(countly_event_id_map.saas_socket_already_opened),void ue.onopen();console.error("saas_socket state is "+ue.readyState),pe(countly_event_id_map.saas_socket_close_pre,ue.readyState),Oe&&(clearInterval(Oe),Oe=null),CP_UTILS.websocket_close(ue,!0),ue=void 0}p(o.saas_ws,o)}),w.on("cp.network_status_change",function(e){e===!0?w.emit("cp.reconnect",CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_REFRESH_TOKEN):(f(CP_CONSTANT.CP_STOP_REASON.disconnect),v("连接出错,联网后会自动重连"))}),w.on("cp.cloud_service_ready",function(e){return console.log("[RES] cloud service ready and resId: "+e),ne=!0,(le=CP_UTILS.getSessionStore("cloud_cidinfo"))?(le.start_timestamp?Y=le.start_timestamp:(Y=Date.now(),le.start_timestamp=Y,CP_UTILS.setSessionStore("cloud_cidinfo",le)),ae=-1,U?U.setCurrentResId(e):ae=e,void m()):void v("内部错误,请刷新重试")});var me=0,ve=!1;w.on("cp.reconnect",function(e){if(console.log("cp.reconnect with opType: "+e+", gIsStoped: "+b+", reconnecting: "+ve+", gIsOnline: "+M),void 0!=e&&e!=-1&&(W=e),me++,me>X)return void N("尝试重新连接次数超过上限",V,!1,CP_CONSTANT.CP_STOP_REASON.internal_error);if(pe(countly_event_id_map.reconnecting,[b,ve].join(",")),oe=null,_e=null,ie=null,ae=-1,ne=!1,ee=!1,b)return console.info("cp.reconnect: game is stoped"),void I("云玩已关闭");if(ve)return console.info("cp.reconnect: game is reconnecting"),void I("正在连接中");if(!M)return void console.info("cp.reconnect: offline now, wait the online notification");ve=!0,U&&U.stopPlay(!1),CP_showLoadingView();var o=CP_UTILS.getSessionStore("game_options");u(o.pkg_name)}),w.on("cp.get_rtmp_addr",function(e){console.log("get rtmp addr: ",JSON.stringify(e)),me=0,oe=e,oe.inputProtocol="haima-cloud-protocol",U&&U.connectInputSocket(oe.inputUrl,oe.inputProtocol),m()});var Ae=!1;w.on(CP_CONSTANT.EVENT_STOP_SDK,function(e,o){N(e,V,!1,o?o:CP_CONSTANT.CP_STOP_REASON.internal)}),w.on(CP_CONSTANT.EVENT_PLAYER_READY,function(){CP_hideLoadingView()});var Ie=!1;return setTimeout(function(){CP_UTILS.hasOwnProperty(window,"__ASYNC_LOAD")?L():h()},50),{initSDK:T,startSDK:P,stopSDK:y,sendPayMessage:E,isStoped:function(){return b},isReconnecting:function(){return ve},isFirstConnect:function(){return!$},eventEmitter:function(){return w},sendCountly:pe,_onbeforeunload:R,_onunload:k,testReconnect:function(){w.emit("cp.reconnect",CP_CONSTANT.GET_CLOUD_SERVICE_TYPE_REFRESH_TOKEN)}}}(WebSocket||{},CryptoJS||{});window.onbeforeunload=Cloudplay._onbeforeunload,window.onunload=Cloudplay._onunload;